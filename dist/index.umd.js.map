{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap e7fb9759f99c6d169613","webpack:///./src/consolePatch.js","webpack:///./src/http.formData.browser.js","webpack:///./src/http.post.browser.js","webpack:///./src/unhandle.browser.js","webpack:///./src/index.js"],"names":["fn","Error","originalWarn","console","warn","bind","originalError","error","args","url","formData","cb","request","XMLHttpRequest","open","send","onload","params","setRequestHeader","JSON","stringify","window","addEventListener","consolePatch","require","default","unhandleSubscribe","IS_BROWSER","httpPost","httpFormData","telebug","inited","config","chatId","defaultBotId","botId","apiUrl","customMessages","customMessage","handleError","handleConsole","message","createErrorMessage","handleErrorMessage","createConsoleMessage","html2canvas","onPhotoSent","sendMessage","makeScreenShot","sendPhoto","blob","type","md","getCommonInfo","length","join","stack","location","href","navigator","userAgent","forEach","msg","promise","document","body","then","canvas","toBlob","FormData","append","text","chat_id","disable_web_page_preview","parse_mode","addCustomMessage","push","module","exports"],"mappings":"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","file":"index.umd.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"telebug\"] = factory();\n\telse\n\t\troot[\"telebug\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"./dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e7fb9759f99c6d169613","export default fn => {\n  if (typeof fn !== 'function')\n    throw new Error('consolePatch: fn must be a function');\n\n  const originalWarn = console.warn.bind(console);\n  const originalError = console.error.bind(console);\n\n  console.warn = (...args) => {\n    fn('warn', ...args), originalWarn(...args);\n  };\n  console.error = (...args) => {\n    fn('error', ...args), originalError(...args);\n  };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/consolePatch.js","export default (url, formData, cb) => {\n  const request = new XMLHttpRequest();\n  request.open('POST', url);\n  request.send(formData);\n  request.onload = cb;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/http.formData.browser.js","export default (url, params) => {\n  var request = new XMLHttpRequest();\n  request.open('POST', url, true);\n  request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n  request.send(JSON.stringify(params));\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/http.post.browser.js","export default fn => {\n  if (typeof fn !== 'function')\n    throw new Error('unhandle: fn must me a function');\n  window.addEventListener('error', fn);\n  window.addEventListener('unhandledrejection', fn);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/unhandle.browser.js","const consolePatch = require('./consolePatch').default;\n\nconst unhandleSubscribe = IS_BROWSER\n  ? require('./unhandle.browser').default\n  : require('./unhandle.node').default;\n\nconst httpPost = IS_BROWSER\n  ? require('./http.post.browser').default\n  : require('./http.post.node').default;\n\nconst httpFormData = IS_BROWSER\n  ? require('./http.formData.browser').default\n  : null;\n\nconst telebug = (function() {\n  let inited = false;\n\n  return function(config = {}) {\n    if (!config.chatId) throw new Error('chatId must be provided');\n    if (inited) throw new Error('Telebug already inited');\n    inited = true;\n\n    const defaultBotId = '474186924:AAGtoPx1A_q9MoLdhRCin5EmGwN7xlC_21g';\n    const botId = config.botId || defaultBotId;\n    const chatId = config.chatId;\n    const apiUrl = `https://api.telegram.org/bot${botId}`;\n    const customMessages = config.customMessage ? [config.customMessage] : [];\n\n    unhandleSubscribe(handleError);\n    consolePatch(handleConsole);\n\n    function handleError(error) {\n      const message = createErrorMessage(error);\n      handleErrorMessage(message);\n    }\n\n    function handleConsole(...args) {\n      const message = createConsoleMessage(...args);\n      handleErrorMessage(message);\n    }\n\n    function handleErrorMessage(message) {\n      if (IS_BROWSER) {\n        if (!window.html2canvas) return;\n        const onPhotoSent = () => sendMessage(message);\n        makeScreenShot(blob => sendPhoto(blob, onPhotoSent));\n      } else sendMessage(message);\n    }\n\n    function createConsoleMessage(type, ...args) {\n      let md = getCommonInfo();\n      md += args.length ? `\\n\\`console.${type}(${args.join(', ')})\\`` : '';\n      return md;\n    }\n\n    function createErrorMessage(error) {\n      let md = getCommonInfo();\n\n      if (typeof error === 'object') {\n        const originalError = error.error || error;\n        if (originalError.stack) md += `\\n\\`${originalError.stack}\\``;\n        else md += `\\n\\`${originalError.message}\\``;\n      } else {\n        md += '\\n' + error;\n      }\n\n      return md;\n    }\n\n    function getCommonInfo() {\n      let md = `*${IS_BROWSER ? 'browser' : 'server'}*`;\n      md += IS_BROWSER ? `\\n${location.href}` : '';\n      md += IS_BROWSER ? `\\n${navigator.userAgent}` : '';\n      customMessages.forEach(msg => (md += `\\n${msg}`));\n      return md;\n    }\n\n    function makeScreenShot(cb) {\n      const promise = html2canvas(document.body);\n      promise.then(canvas => {\n        canvas.toBlob(cb, 'image/jpeg', 0.7);\n      });\n    }\n\n    function sendPhoto(blob, cb) {\n      const url = `${apiUrl}/sendPhoto`;\n      const formData = new FormData();\n      formData.append('chat_id', chatId);\n      formData.append('photo', blob);\n      httpFormData(url, formData, cb);\n    }\n\n    function sendMessage(text) {\n      const url = `${apiUrl}/sendMessage`;\n      httpPost(url, {\n        chat_id: chatId,\n        disable_web_page_preview: true,\n        parse_mode: 'markdown',\n        text,\n      });\n    }\n\n    function addCustomMessage(message) {\n      customMessages.push(message);\n    }\n\n    return {\n      sendMessage,\n      sendPhoto,\n      addCustomMessage,\n    };\n  };\n})();\n\nmodule.exports = telebug;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}