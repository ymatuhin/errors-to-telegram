{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 34da19fbadc3d59477a1","webpack:///./src/consolePatch.js","webpack:///./src/http.post.browser.js","webpack:///./src/unhandle.browser.js","webpack:///./src/index.js"],"names":["fn","Error","originalWarn","console","warn","bind","originalError","error","args","url","params","request","XMLHttpRequest","open","setRequestHeader","send","JSON","stringify","window","addEventListener","consolePatch","require","default","unhandleSubscribe","IS_BROWSER","httpPost","errorsToTelegram","config","inited","botId","chatId","handleError","handleConsole","message","createErrorMessage","sendMessage","createConsoleMessage","md","location","href","navigator","userAgent","type","getCommonInfo","length","join","stack","file","filename","lineno","colno","text","chat_id","parse_mode","module","exports"],"mappings":"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","file":"index.umd.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"errorsToTelegram\"] = factory();\n\telse\n\t\troot[\"errorsToTelegram\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 34da19fbadc3d59477a1","export default fn => {\n  if (typeof fn !== 'function')\n    throw new Error('consolePatch: fn must be a function');\n\n  const originalWarn = console.warn.bind(console);\n  const originalError = console.error.bind(console);\n\n  console.warn = (...args) => {\n    fn('warn', ...args), originalWarn(...args);\n  };\n  console.error = (...args) => {\n    fn('error', ...args), originalError(...args);\n  };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/consolePatch.js","export default (url, params) => {\n  var request = new XMLHttpRequest();\n  request.open('POST', url, true);\n  request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n  request.send(JSON.stringify(params));\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/http.post.browser.js","export default fn => {\n  if (typeof fn !== 'function')\n    throw new Error('unhandle: fn must me a function');\n  window.addEventListener('error', fn);\n  window.addEventListener('unhandledrejection', fn);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/unhandle.browser.js","const consolePatch = require('./consolePatch').default;\n\nconst unhandleSubscribe = IS_BROWSER\n  ? require('./unhandle.browser').default\n  : require('./unhandle.node').default;\n\nconst httpPost = IS_BROWSER\n  ? require('./http.post.browser').default\n  : require('./http.post.node').default;\n\nclass errorsToTelegram {\n  constructor(config) {\n    this.inited = false;\n    this.botId = null;\n    this.chatId = null;\n  }\n\n  init(config = {}) {\n    if (this.inited) throw new Error('errorsToTelegram already inited');\n    if (!config.botId) throw new Error('botId must be provided');\n    if (!config.chatId) throw new Error('chatId must be provided');\n    this.botId = config.botId;\n    this.chatId = config.chatId;\n    this.inited = true;\n\n    unhandleSubscribe(this.handleError.bind(this));\n    consolePatch(this.handleConsole.bind(this));\n  }\n\n  handleError(error) {\n    const message = this.createErrorMessage(error);\n    this.sendMessage(message);\n  }\n\n  handleConsole(...args) {\n    const message = this.createConsoleMessage(...args);\n    this.sendMessage(message);\n  }\n\n  getCommonInfo() {\n    let md = `*==${IS_BROWSER ? 'browser' : 'server'}==*`;\n    md += IS_BROWSER ? `\\n*Url* ${location.href}` : '';\n    md += IS_BROWSER ? `\\n*UserAgent* ${navigator.userAgent}` : '';\n    return md;\n  }\n\n  createConsoleMessage(type, ...args) {\n    let md = this.getCommonInfo();\n    md += args.length ? `\\n*Console.${type}*: \\`${args.join(', ')}\\`` : '';\n    return md;\n  }\n\n  createErrorMessage(error) {\n    let md = this.getCommonInfo();\n\n    if (typeof error === 'object') {\n      const message = error.message || error.error;\n      const stack = error.stack || error.error.stack;\n      const file = error.filename\n        ? `${error.filename}:${error.lineno}:${error.colno}`\n        : '';\n      md += message ? `\\n*Message* ${message}` : '';\n      md += file ? `\\n*File* ${file}` : '';\n      md += stack ? `\\n\\`${stack}\\`` : '';\n    } else {\n      md += message ? `\\n*Message* ${error}\\n` : '';\n    }\n    return md;\n  }\n\n  sendMessage(text) {\n    const url = `https://api.telegram.org/bot${this.botId}/sendMessage`;\n    httpPost(url, {\n      chat_id: this.chatId,\n      parse_mode: 'markdown',\n      text,\n    });\n  }\n}\nmodule.exports = new errorsToTelegram();\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}