{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 73f136680845f6043190","webpack:///./src/consolePatch.js","webpack:///./src/http.post.node.js","webpack:///./src/unhandle.node.js","webpack:///./src/index.js","webpack:///external \"https\"","webpack:///external \"process\""],"names":["fn","Error","originalWarn","console","warn","bind","originalError","error","args","https","require","url","params","slice","split","host","path","postData","JSON","stringify","options","hostname","method","headers","length","req","request","write","end","process","on","consolePatch","default","unhandleSubscribe","IS_BROWSER","httpPost","httpFormData","errorsToTelegram","config","inited","botId","chatId","apiUrl","handleError","handleConsole","message","createErrorMessage","handleErrorMessage","createConsoleMessage","window","html2canvas","onPhotoSent","sendMessage","makeScreenShot","sendPhoto","blob","md","location","href","navigator","userAgent","type","getCommonInfo","join","stack","cb","promise","document","body","then","canvas","toBlob","formData","FormData","append","text","chat_id","disable_web_page_preview","parse_mode","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"https\"), require(\"process\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"https\", \"process\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"errorsToTelegram\"] = factory(require(\"https\"), require(\"process\"));\n\telse\n\t\troot[\"errorsToTelegram\"] = factory(root[\"https\"], root[\"process\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_5__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"./dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 73f136680845f6043190","export default fn => {\n  if (typeof fn !== 'function')\n    throw new Error('consolePatch: fn must be a function');\n\n  const originalWarn = console.warn.bind(console);\n  const originalError = console.error.bind(console);\n\n  console.warn = (...args) => {\n    fn('warn', ...args), originalWarn(...args);\n  };\n  console.error = (...args) => {\n    fn('error', ...args), originalError(...args);\n  };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/consolePatch.js","const https = require('https');\n\nexport default (url, params) => {\n  const [host, path] = url.slice(8).split('.org');\n\n  const postData = JSON.stringify(params);\n\n  const options = {\n    hostname: host + '.org',\n    path,\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json; charset=UTF-8',\n      'Content-Length': postData.length,\n    },\n  };\n\n  const req = https.request(options);\n  req.write(postData);\n  req.end();\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/http.post.node.js","const process = require('process');\n\nexport default fn => {\n  if (typeof fn !== 'function')\n    throw new Error('unhandle: fn must be a function');\n\n  process.on('uncaughtException', fn);\n  process.on('unhandledRejection', fn);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/unhandle.node.js","const consolePatch = require('./consolePatch').default;\n\nconst unhandleSubscribe = IS_BROWSER\n  ? require('./unhandle.browser').default\n  : require('./unhandle.node').default;\n\nconst httpPost = IS_BROWSER\n  ? require('./http.post.browser').default\n  : require('./http.post.node').default;\n\nconst httpFormData = IS_BROWSER\n  ? require('./http.formData.browser').default\n  : null;\n\nclass errorsToTelegram {\n  constructor(config) {\n    this.inited = false;\n    this.botId = null;\n    this.chatId = null;\n  }\n\n  init(config = {}) {\n    if (this.inited) throw new Error('errorsToTelegram already inited');\n    if (!config.botId) throw new Error('botId must be provided');\n    if (!config.chatId) throw new Error('chatId must be provided');\n\n    this.botId = config.botId;\n    this.chatId = config.chatId;\n    this.apiUrl = `https://api.telegram.org/bot${this.botId}`;\n    this.inited = true;\n\n    unhandleSubscribe(this.handleError.bind(this));\n    consolePatch(this.handleConsole.bind(this));\n  }\n\n  handleError(error) {\n    const message = this.createErrorMessage(error);\n    this.handleErrorMessage(message);\n  }\n\n  handleConsole(...args) {\n    const message = this.createConsoleMessage(...args);\n    this.handleErrorMessage(message);\n  }\n\n  handleErrorMessage(message) {\n    if (IS_BROWSER) {\n      if (!window.html2canvas) return;\n      const onPhotoSent = () => this.sendMessage(message);\n      this.makeScreenShot(blob => this.sendPhoto(blob, onPhotoSent));\n    } else this.sendMessage(message);\n  }\n\n  getCommonInfo() {\n    let md = `*${IS_BROWSER ? 'browser' : 'server'}*`;\n    md += IS_BROWSER ? `\\n${location.href}` : '';\n    md += IS_BROWSER ? `\\n${navigator.userAgent}` : '';\n    return md;\n  }\n\n  createConsoleMessage(type, ...args) {\n    let md = this.getCommonInfo();\n    md += args.length ? `\\n\\`console.${type}(${args.join(', ')})\\`` : '';\n    return md;\n  }\n\n  createErrorMessage(error) {\n    let md = this.getCommonInfo();\n\n    if (typeof error === 'object') {\n      const originalError = error.error || error;\n      if (originalError.stack) md += `\\n\\`${originalError.stack}\\``;\n      else md += `\\n\\`${originalError.message}\\``;\n    } else {\n      md += '\\n' + error;\n    }\n\n    return md;\n  }\n\n  makeScreenShot(cb) {\n    const promise = html2canvas(document.body);\n    promise.then(canvas => {\n      canvas.toBlob(cb, 'image/jpeg', 0.7);\n    });\n  }\n\n  sendPhoto(blob, cb) {\n    const url = `${this.apiUrl}/sendPhoto`;\n    const formData = new FormData();\n    formData.append('chat_id', this.chatId);\n    formData.append('photo', blob);\n    httpFormData(url, formData, cb);\n  }\n\n  sendMessage(text) {\n    const url = `${this.apiUrl}/sendMessage`;\n    httpPost(url, {\n      chat_id: this.chatId,\n      disable_web_page_preview: true,\n      parse_mode: 'markdown',\n      text,\n    });\n  }\n}\n\nmodule.exports = new errorsToTelegram();\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"https\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"https\"\n// module id = 4\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_5__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"process\"\n// module id = 5\n// module chunks = 0"],"sourceRoot":""}